<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Datos de Educación en Colombia</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        text-align: center;
        margin-bottom: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #2c3e50;
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 700;
      }

      .subtitle {
        color: #7f8c8d;
        font-size: 1.2em;
        margin-bottom: 20px;
      }

      .controls {
        display: flex;
        gap: 20px;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 30px;
      }

      .control-group {
        background: rgba(255, 255, 255, 0.9);
        padding: 15px 20px;
        border-radius: 15px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .control-group:hover {
        transform: translateY(-5px);
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #34495e;
      }

      select,
      input[type="file"] {
        padding: 10px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 16px;
        transition: border-color 0.3s ease;
        min-width: 200px;
      }

      select:focus,
      input[type="file"]:focus {
        outline: none;
        border-color: #3498db;
      }

      button {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 25px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
      }

      .dashboard {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .chart-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
      }

      .chart-title {
        font-size: 1.4em;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 20px;
        text-align: center;
      }

      .chart {
        height: 300px;
        position: relative;
        overflow: hidden;
      }

      .bar-chart {
        display: flex;
        align-items: flex-end;
        height: 100%;
        gap: 10px;
        padding: 10px;
      }

      .bar {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        border-radius: 5px 5px 0 0;
        position: relative;
        min-width: 30px;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .bar:hover {
        filter: brightness(1.1);
        transform: scaleY(1.05);
      }

      .bar-label {
        position: absolute;
        bottom: -25px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 12px;
        font-weight: 600;
        color: #34495e;
        text-align: center;
        width: max-content;
      }

      .bar-value {
        position: absolute;
        top: -25px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 11px;
        font-weight: 600;
        color: #2c3e50;
        background: rgba(255, 255, 255, 0.9);
        padding: 2px 6px;
        border-radius: 4px;
        white-space: nowrap;
      }

      .data-table {
        grid-column: 1 / -1;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }

      th,
      td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
      }

      th {
        background: linear-gradient(135deg, #34495e, #2c3e50);
        color: white;
        font-weight: 600;
        position: sticky;
        top: 0;
      }

      tr:hover {
        background: rgba(52, 152, 219, 0.1);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-value {
        font-size: 2.2em;
        font-weight: 700;
        color: #e74c3c;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #7f8c8d;
        font-weight: 600;
      }

      .loading {
        text-align: center;
        padding: 50px;
        color: #7f8c8d;
        font-size: 1.2em;
      }

      .error {
        background: rgba(231, 76, 60, 0.1);
        color: #e74c3c;
        padding: 15px;
        border-radius: 10px;
        margin: 20px 0;
        text-align: center;
      }

      @media (max-width: 768px) {
        .dashboard {
          grid-template-columns: 1fr;
        }

        .controls {
          flex-direction: column;
        }

        h1 {
          font-size: 2em;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>📊 Datos de Educación en Colombia</h1>
        <p class="subtitle">
          Visualización interactiva de indicadores educativos
        </p>
      </header>

      <div class="controls">
        <div class="control-group">
          <label for="fileInput">Cargar archivo CSV:</label>
          <input type="file" id="fileInput" accept=".csv" />
        </div>
        <div class="control-group">
          <label for="regionFilter">Filtrar por región:</label>
          <select id="regionFilter">
            <option value="">Todas las regiones</option>
          </select>
        </div>
        <div class="control-group">
          <label for="metricSelect">Métrica a visualizar:</label>
          <select id="metricSelect">
            <option value="matricula">Matrícula</option>
            <option value="desercion">Deserción (%)</option>
            <option value="graduados">Graduados</option>
          </select>
        </div>
        <div class="control-group">
          <button onclick="loadSampleData()">Cargar Datos de Ejemplo</button>
        </div>
      </div>

      <div class="stats-grid" id="statsGrid" style="display: none">
        <div class="stat-card">
          <div class="stat-value" id="totalStudents">0</div>
          <div class="stat-label">Total Estudiantes</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="avgDesertion">0%</div>
          <div class="stat-label">Deserción Promedio</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalGraduates">0</div>
          <div class="stat-label">Total Graduados</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalInstitutions">0</div>
          <div class="stat-label">Instituciones</div>
        </div>
      </div>

      <div class="dashboard">
        <div class="chart-container">
          <h3 class="chart-title">Matrícula por Departamento</h3>
          <div class="chart" id="matriculaChart">
            <div class="loading">
              Carga un archivo CSV para visualizar los datos
            </div>
          </div>
        </div>
        <div class="chart-container">
          <h3 class="chart-title">Deserción por Departamento</h3>
          <div class="chart" id="desercionChart">
            <div class="loading">
              Carga un archivo CSV para visualizar los datos
            </div>
          </div>
        </div>
      </div>

      <div class="data-table">
        <h3 class="chart-title">Tabla de Datos</h3>
        <div id="tableContainer">
          <div class="loading">
            Carga un archivo CSV para ver la tabla de datos
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
      let currentData = [];
      let filteredData = [];

      // Datos de ejemplo para Colombia
      const sampleData = `departamento,region,matricula,desercion,graduados,instituciones
													Antioquia,Andina,850000,12.5,45000,450
													Bogotá D.C.,Andina,920000,8.2,52000,380
													Valle del Cauca,Andina,480000,14.1,28000,320
													Cundinamarca,Andina,320000,11.8,18000,280
													Santander,Andina,410000,13.2,22000,250
													Atlántico,Caribe,380000,15.8,20000,180
													Bolívar,Caribe,290000,16.5,15000,150
													Córdoba,Caribe,250000,18.2,12000,140
													Sucre,Caribe,180000,19.1,8000,95
													Magdalena,Caribe,220000,17.8,10000,110
													Meta,Orinoquia,150000,16.2,8000,85
													Casanare,Orinoquia,95000,15.5,5000,60
													Arauca,Orinoquia,80000,17.2,4000,45
													Vichada,Orinoquia,25000,22.1,1200,25
													Huila,Andina,280000,14.5,15000,180
													Tolima,Andina,260000,15.2,14000,170
													Boyacá,Andina,240000,13.8,13000,200
													Nariño,Pacífica,320000,16.8,17000,190
													Cauca,Pacífica,250000,17.5,13000,160
													Chocó,Pacífica,120000,24.2,5000,80
													Putumayo,Amazonia,85000,19.5,4000,55
													Caquetá,Amazonia,110000,20.1,5500,65
													Amazonas,Amazonia,45000,21.8,2000,35
													Guainía,Amazonia,15000,23.5,800,20
													Vaupés,Amazonia,12000,25.1,600,18`;

      function loadSampleData() {
        Papa.parse(sampleData, {
          header: true,
          complete: function (results) {
            processData(results.data);
          },
        });
      }

      function processData(data) {
        // Limpiar datos
        currentData = data.filter(
          (row) => row.departamento && row.departamento.trim() !== ""
        );

        // Convertir números
        currentData = currentData.map((row) => ({
          ...row,
          matricula: parseInt(row.matricula) || 0,
          desercion: parseFloat(row.desercion) || 0,
          graduados: parseInt(row.graduados) || 0,
          instituciones: parseInt(row.instituciones) || 0,
        }));

        updateRegionFilter();
        updateData();
      }

      function updateRegionFilter() {
        const regionFilter = document.getElementById("regionFilter");
        const regions = [...new Set(currentData.map((row) => row.region))];

        regionFilter.innerHTML = '<option value="">Todas las regiones</option>';
        regions.forEach((region) => {
          const option = document.createElement("option");
          option.value = region;
          option.textContent = region;
          regionFilter.appendChild(option);
        });
      }

      function updateData() {
        const regionFilter = document.getElementById("regionFilter").value;

        filteredData = currentData.filter((row) => {
          return !regionFilter || row.region === regionFilter;
        });

        updateStats();
        updateCharts();
        updateTable();
      }

      function updateStats() {
        if (filteredData.length === 0) return;

        const totalStudents = filteredData.reduce(
          (sum, row) => sum + row.matricula,
          0
        );
        const avgDesertion =
          filteredData.reduce((sum, row) => sum + row.desercion, 0) /
          filteredData.length;
        const totalGraduates = filteredData.reduce(
          (sum, row) => sum + row.graduados,
          0
        );
        const totalInstitutions = filteredData.reduce(
          (sum, row) => sum + row.instituciones,
          0
        );

        document.getElementById("totalStudents").textContent =
          totalStudents.toLocaleString();
        document.getElementById("avgDesertion").textContent =
          avgDesertion.toFixed(1) + "%";
        document.getElementById("totalGraduates").textContent =
          totalGraduates.toLocaleString();
        document.getElementById("totalInstitutions").textContent =
          totalInstitutions.toLocaleString();

        document.getElementById("statsGrid").style.display = "grid";
      }

      function updateCharts() {
        const metric = document.getElementById("metricSelect").value;
        updateBarChart(
          "matriculaChart",
          "matricula",
          "Matrícula por Departamento"
        );
        updateBarChart(
          "desercionChart",
          "desercion",
          "Deserción por Departamento"
        );
      }

      function updateBarChart(containerId, metric, title) {
        const container = document.getElementById(containerId);
        const chartTitle = container.previousElementSibling;
        chartTitle.textContent = title;

        if (filteredData.length === 0) {
          container.innerHTML =
            '<div class="loading">No hay datos para mostrar</div>';
          return;
        }

        // Ordenar datos por métrica
        const sortedData = [...filteredData]
          .sort((a, b) => b[metric] - a[metric])
          .slice(0, 10);
        const maxValue = Math.max(...sortedData.map((row) => row[metric]));

        const barChart = document.createElement("div");
        barChart.className = "bar-chart";

        sortedData.forEach((row) => {
          const bar = document.createElement("div");
          bar.className = "bar";
          const height = (row[metric] / maxValue) * 100;
          bar.style.height = height + "%";
          bar.style.flex = "1";

          const label = document.createElement("div");
          label.className = "bar-label";
          label.textContent =
            row.departamento.substring(0, 8) +
            (row.departamento.length > 8 ? "..." : "");

          const value = document.createElement("div");
          value.className = "bar-value";
          value.textContent =
            metric === "desercion"
              ? row[metric].toFixed(1) + "%"
              : row[metric].toLocaleString();

          bar.appendChild(label);
          bar.appendChild(value);
          barChart.appendChild(bar);
        });

        container.innerHTML = "";
        container.appendChild(barChart);
      }

      function updateTable() {
        const tableContainer = document.getElementById("tableContainer");

        if (filteredData.length === 0) {
          tableContainer.innerHTML =
            '<div class="loading">No hay datos para mostrar</div>';
          return;
        }

        const table = document.createElement("table");
        table.innerHTML = `
                <thead>
                    <tr>
                        <th>Departamento</th>
                        <th>Región</th>
                        <th>Matrícula</th>
                        <th>Deserción (%)</th>
                        <th>Graduados</th>
                        <th>Instituciones</th>
                    </tr>
                </thead>
                <tbody>
                    ${filteredData
                      .map(
                        (row) => `
                        <tr>
                            <td>${row.departamento}</td>
                            <td>${row.region}</td>
                            <td>${row.matricula.toLocaleString()}</td>
                            <td>${row.desercion.toFixed(1)}%</td>
                            <td>${row.graduados.toLocaleString()}</td>
                            <td>${row.instituciones.toLocaleString()}</td>
                        </tr>
                    `
                      )
                      .join("")}
                </tbody>
            `;

        tableContainer.innerHTML = "";
        tableContainer.appendChild(table);
      }

      // Event listeners
      document
        .getElementById("fileInput")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            Papa.parse(file, {
              header: true,
              complete: function (results) {
                processData(results.data);
              },
              error: function (error) {
                console.error("Error al leer el archivo:", error);
                alert("Error al leer el archivo CSV");
              },
            });
          }
        });

      document
        .getElementById("regionFilter")
        .addEventListener("change", updateData);
      document
        .getElementById("metricSelect")
        .addEventListener("change", updateCharts);

      // Cargar datos de ejemplo al inicio
      loadSampleData();
    </script>
  </body>
</html>
